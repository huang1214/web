<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--        add(comName,applicantId,teacher1Id,teacher2Id,unit,leader,teamNum,team,studentPrice,teacherPrice,
        awardTypeId,awardDate,applicantBankCard,workName,workBriefIntro)-->
<mapper namespace="com.aca.springboot.mapper.ApplicationMapper">

    <!--简写了-->
    <resultMap id="ACALVO" type="com.aca.springboot.vo.AppComAppLeaderVO">
        <id property="appid" column="APPID"></id>
        <result property="ctid" column="CTID"></result>
        <result property="applicantId" column="APPLICANTID"></result>
        <result property="unit" column="UNIT"></result>
        <result property="leader" column="LEADER"></result>
        <result property="studentPrice" column="STUDENTPRICE"></result>
        <result property="teacherPrice" column="TEACHERPRICE"></result>
        <result property="awardTypeId" column="AWARDTYPEID"></result>
        <result property="awardDate" column="AWARDDATE"></result>
        <result property="applicantBankCard" column="APPLICANTBANKCARD"></result>
        <result property="workName" column="WORKNAME"></result>
        <result property="workBriefIntro" column="WORKBRIEFINTRO"></result>
        <result property="status" column="STATUS"></result>
        <result property="note" column="NOTE"></result>
        <association property="competion" javaType="com.aca.springboot.entities.Competition">
            <id property="ctid" column="ctid(1)"/>
            <result property="ctname" column="ctname"/>
            <result property="host_unit" column="host_unit"/>
            <result property="com_type" column="com_type"/>
            <result property="result_type" column="result_type"/>
            <result property="reference_paper" column="reference_paper"/>
        </association>
        <association property="appplicantStu" javaType="com.aca.springboot.entities.Student">
            <id property="sno" column="sno"/>
            <result property="sname" column="sname"/>
            <result property="ssex" column="ssex"/>
            <result property="sbirthday" column="sbirthday"/>
            <result property="sdomitory" column="sdomitory"/>
            <result property="cno" column="cno"/>
            <result property="spwd" column="spwd"/>
            <result property="stel" column="stel"/>
            <result property="state" column="state"/>
            <result property="card_num" column="card_num"/>
        </association>
        <association property="leaderStu" javaType="com.aca.springboot.entities.Student">
            <id property="sno" column="sno(1)"/>
            <result property="sname" column="sname(1)"/>
            <result property="ssex" column="ssex(1)"/>
            <result property="sbirthday" column="sbirthday(1)"/>
            <result property="sdomitory" column="sdomitory(1)"/>
            <result property="cno" column="cno(1)"/>
            <result property="spwd" column="spwd(1)"/>
            <result property="stel" column="stel(1)"/>
            <result property="state" column="state(1)"/>
            <result property="card_num" column="card_num(1)"/>
        </association>
    </resultMap>


    <insert id="add" parameterType="com.aca.springboot.entities.Application">
        insert into Application(appId,ctid,applicantId,unit,leader,awardDate,applicantBankCard,workName,workBriefIntro,certificateImg,studentPrice,teacherPrice,awardTypeId)
        values (#{appid},#{ctid},#{applicantId},#{unit},#{leader},to_date(substr(#{awardDate},1,10),'yyyy-mm-dd'),#{applicantBankCard},#{workName},#{workBriefIntro},#{certificateImg,jdbcType=BLOB},#{studentPrice},#{teacherPrice},#{awardTypeId})
    </insert>

    <!--插入奖金申请表对应表-->
    <insert id="addApplicationMember" parameterType="com.aca.springboot.entities.ApplicationMember">
        insert into APPLICATION_MEMBER(APP_ID,APP_TM_ID,APP_TYPE,APP_ORDER)
        values (#{appId},#{appTmId},#{appType},#{appOrder})
    </insert>
    <!-- 查询全部比赛名称 -->
    <resultMap id="com_name_all" type="com.aca.springboot.entities.Application">
        <result property="competition_name" column="ctname"/>
    </resultMap>
    <select id="com_name" resultMap="com_name_all">
        select ctname from com_table
    </select>

    <!-- 调用返还获奖类型的函数 -->
    <parameterMap id="awardtype" type="java.util.Map">
    </parameterMap>
    <select id="getawardtype" parameterMap="awardtype" statementType="CALLABLE">
        {#{awardtype,mode=OUT,jdbcType=CHAR} = call application_award_type(
                #{u_ctId,mode=IN,jdbcType=VARCHAR},
                #{u_level_type,mode=IN,jdbcType=CHAR},
                #{u_prize_type,mode=IN,jdbcType=CHAR})}
    </select>

    <!--获取老师学生获奖金额-->
    <select id="get_price" resultType="map">
        select teacher_price,student_price from award_type where atid = #{atid}
    </select>

    <!--取得ACALVO-->
    <select id="get_application_list" resultMap="ACALVO">
      select * from (select * from application order by status desc) A JOIN
      (select * from com_table ) C ON A.ctid=C.ctid JOIN
      (select * from STUDENT) S1 ON S1.SNO=A.APPLICANTID JOIN
      (select * from STUDENT) S2 ON S2.SNO=A.LEADER
    </select>
    <!--<resultMap id="workresult" type="com.aca.springboot.entities.work">-->
    <!--<id column="app_id" property="app_id"/>-->
    <!--<result column="competition_name" property="competition_name"/>-->
    <!--<result column="work_name" property="work_name"/>-->
    <!--<result column="leader_id" property="leader_id"/>-->
    <!--<result column="teacher_id" property="teacher_id"/>-->
    <!--<result column="date_year" property="date_year"/>-->
    <!--<result column="stu_price" property="student_price"/>-->
    <!--<result column="tea_price" property="teacher_price"/>-->
    <!--<result column="is_check" property="is_check"/>-->
    <!--</resultMap>-->
    <!--<select id="workresult" resultMap="workresult">-->
    <!--select a.app_id,a.competition_name,a.work_name,a.leader_id,a.teacher_id,a.date_year,s.stu_price,s.tea_price,s.is_check-->
    <!--from application a,application_succ s-->
    <!--where a.app_id = s.app_id and-->
    <!--s.leader_id = #{leader_id}-->
    <!--order by app_id-->
    <!--</select>-->

    <!--<select id="work_paaAll" resultMap="workresult">-->
    <!--select a.app_id,a.competition_name,a.work_name,a.leader_id,a.teacher_id,a.date_year,s.stu_price,s.tea_price,s.is_check-->
    <!--from application a,application_succ s-->
    <!--where a.app_id = s.app_id-->
    <!--order by app_id-->
    <!--</select>-->

    <!--申请表和获奖类型表一对一级联-->
    <select id="application_All" resultMap="applicationMap">
        select *  from application where applicantId= #{applicantId}
    </select>

    <!--    通过关联处理，其中select元素指定的sql查询，而column则是指定传递给select的参数，是user对象id。
        当取出User的时候，MyBatis就知道下面的sql取出我们需要的级联信息。-->
    <resultMap id="applicationMap" type="com.aca.springboot.entities.Application">
        <!--<association property="award" column="awardTypeId" select="com.aca.springboot.mapper.AwardMapper.findAwardTypeByAtid"/>-->
    </resultMap>

</mapper>
