<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>基本资料</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="https://www.layuicdn.com/layui/css/layui.css">
    <script src="https://www.layuicdn.com/layui/layui.js"></script>
</head>
<style>
    .formdata{
        width: 645px;
        margin: 25px auto;
    }
    #layer_ctname,#layer_teacher1Id,#layer_teacher2Id,#layer_studentId{
        display: none;
    }
    .disappear{
        display: none;
    }
    #get_tname{
        display: block;
        width: 100%;
        padding-left: 10px;
        border-color: #e6e6e6;
        text-align: left;
    }
    #search{
        margin-left:30px;
    }
    .layui-form-pane .layui-form-label {
        width: 110px;
        padding: 8px 15px;
        height: 38px;
        line-height: 20px;
        border-width: 1px;
        border-style: solid;
        border-radius: 2px 0 0 2px;
        text-align: center;
        background-color: #FBFBFB;
        overflow: visible;
        box-sizing: border-box;
    }
    #layer_teacher1Id .layui-input{
        margin-top: 5px;
    }
    #layer_teacher1Id button{
        margin-top: 5px;
    }

    .layui-input:focus, .layui-textarea:focus{
        border-color:#5FB878!important
    }
    .comLeaderBox{
        background-color:#2F4056;
    }
    #btn_search_student{
        margin-top: 10px;
        margin-left: 50px;
    }
</style>
<script>
    function chooseTeacherBox(){
        layer.open({
            type: 1  //1为页面层
            ,title: '指导老师编号'  //弹出层标题
            ,area: ['800px', '400px']   //设置弹出层大小[宽，高]
            , offset: 'auto'   //设置弹出层位置 //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
            , id: 'layerDemo_teacher2Id' //防止重复弹出，点击这个input只能有一个弹出层
            ,content:$("#layer_teacher2Id")   //弹出层内容为layer_ctname块，不能直接是表格id
            , btnAlign: 'c' //按钮居中
            , shade: 0 //不显示遮罩
            , yes: function () {  //确定按钮回调方法， 需要手动关闭弹出层
                layer.closeAll();
            }
        });
    }
    function chooseStudentBox(othis) {
        studentTemp = othis;
        layer.open({
            type: 1  //1为页面层
            ,title: '学生信息'  //弹出层标题
            ,area: ['800px', '400px']   //设置弹出层大小[宽，高]
            , offset: 'auto'   //设置弹出层位置 //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
            , id: 'layerDemo_studentId' //防止重复弹出，点击这个input只能有一个弹出层
            ,content:$("#layer_studentId")   //弹出层内容为layer_ctname块，不能直接是表格id
            , btnAlign: 'c' //按钮居中
            , shade: 0 //不显示遮罩
            , yes: function () {  //确定按钮回调方法， 需要手动关闭弹出层
                layer.closeAll();
            }
        });
    }
</script>
<body>
<!--弹出层：比赛名称-->
<div id="layer_ctname">
    <form class="layui-form" action="" style="margin-top: 20px">
        <label class="layui-form-label">关键词：</label>
        <div class="layui-inline">
            <input class="layui-input" name="search_ctname" id="search_ctname" autocomplete="off" placeholder="请输入比赛名称的关键词">
        </div>
        <button type="button" class="layui-btn" data-type="reload" id="btn_search_ctname">搜索</button>
        <button type="reset" class="layui-btn" id="btn_reset_ctname">重置</button>
    </form>
    <table class="layui-hide" id="layer_com_table" lay-filter="layer_com_table"></table>
</div>


<!--弹出层：指导老师编号-->
<div id="layer_teacher2Id">
    <form class="layui-form" action="" style="margin-top: 20px">
        <div class="layui-row">
            <label class="layui-form-label">教师编号：</label>
            <div class="layui-inline" style="margin-right: 50px">
                <input class="layui-input" name="search_tno2" id="search_tno2" autocomplete="off" placeholder="" >
            </div>

            教师姓名：
            <div class="layui-inline">
                <input class="layui-input" name="search_tname2" id="search_tname2" autocomplete="off" placeholder="">
            </div>
            <br>

            <label class="layui-form-label">所属学院：</label>
            <div class="layui-inline" style="margin-right: 50px">
                <input class="layui-input" name="search_dcollege2" id="search_dcollege2" autocomplete="off" placeholder="" >
            </div>

            所属部门：
            <div class="layui-inline">
                <input class="layui-input" name="search_dname2" id="search_dname2" autocomplete="off" placeholder="">
            </div>
            <br>

            <label class="layui-form-label">教师职称：</label>
            <div class="layui-inline" style="margin-right: 150px">
                <input class="layui-input" name="search_ttitle2" id="search_ttitle2" autocomplete="off" placeholder="" >
            </div>
            <div class="layui-inline">
                <button type="button" class="layui-btn" data-type="reload" id="btn_search_teacher2Id">搜索</button>
                <button type="reset" class="layui-btn" style="margin-left: 30px">重置</button>
            </div>
        </div>
    </form>
    <table class="layui-hide" id="layer_teacher2Id_table" lay-filter="layer_teacher2Id_table"></table>
</div>
<!--弹出层：学生选框-->
<div id="layer_studentId">
    <form class="layui-form" action="" style="margin-top: 20px">
        <div class="layui-row">
            <label class="layui-form-label">学生编号：</label>
            <div class="layui-inline" style="margin-right: 50px">
                <input class="layui-input" name="search_sno" id="search_sno" autocomplete="off" placeholder="" >
            </div>

            学生姓名：
            <div class="layui-inline">
                <input class="layui-input" name="search_sname" id="search_sname" autocomplete="off" placeholder="">
            </div>
            <br>
            <div class="layui-inline" style="text-align: center;">
                <button type="button" class="layui-btn" data-type="reload" id="btn_search_student">搜索</button>
                <button type="reset" class="layui-btn" data-type="reload">重置</button>
            </div>
        </div>
    </form>
    <table class="layui-hide" id="layer_studentId_table" lay-filter="layer_studentId_table"></table>
</div>

<!--表单部分-->

<div class="formdata">
    <fieldset class="layui-elem-field layui-field-title" style="margin-top: 10px;">
        <legend>学科竞赛成果申报表</legend>
    </fieldset>
<!--    <form class="layui-form layui-form-pane" action="/app/add" method="post" enctype="multipart/form-data">-->
    =<form class="layui-form layui-form-pane" method="post" enctype="multipart/form-data">
    <div class="layui-row">
        <div class="layui-form-item layui-col-xs6 layui-col-sm6 layui-col-md12">
            <label class="layui-form-label" >比赛名称<span style="color: red">*</span></label>
            <div class="layui-input-block" id="layerDemo_ctname">
                <input type="text"  class="layui-btn layui-btn-primary" name="ctName" id="get_tname" data-method="offset" autocomplete="off" data-type="t" lay-verify="verify_ctname" placeholder="请输入比赛名称">
            </div>
        </div>
        <div class="layui-form-item layui-col-xs6 layui-col-sm6 layui-col-md12" style="display: none">
            <label class="layui-form-label" >比赛编号<span style="color: red">*</span></label>
            <div class="layui-input-block" id="layerDemo_ctId">
                <input type="text"  class="layui-btn layui-btn-primary" name="ctId" id="ctId" data-method="offset" autocomplete="off" data-type="t" lay-verify="verify_ctId" placeholder="">
            </div>
        </div>
        <div class="layui-form-item" id="div_workName">
            <label class="layui-form-label">参赛作品名称<span style="color: red">*</span></label>
            <div class="layui-input-block">
                <input type="text" name="workName" id="workName" autocomplete="off" placeholder="请输入参赛作品名称" class="layui-input" lay-verify="verify_workName" >
            </div>
        </div>

        <div class="layui-form-item">

            <div class="layui-inline">
                <label class="layui-form-label">获奖时间<span style="color: red">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="awardDate" id="awardDate" autocomplete="off" placeholder="yyyy-mm-dd" class="layui-input" lay-verify="verify_awardDate">
                </div>
            </div>

            <div class="layui-inline" style="float: right;">
                <label class="layui-form-label">获奖第一单位<span style="color: red">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="unit" id="unit" value="南昌大学软件学院" autocomplete="off" class="layui-input" lay-verify="verify_unit" readonly>
                </div>
            </div>
        </div>

        <div class="layui-form-item">
            <label class="layui-form-label">获奖类型<span style="color: red">*</span></label>
            <div class="layui-input-inline">
                <select name="level_type" lay-verify="verify_level_type">
                    <option value="">--</option>
                    <option value="0">省级</option>
                    <option value="1">国家级</option>
                    <option value="2">校级</option>
                    <option value="3">院级</option>
                </select>
            </div>
            <div class="layui-input-inline">
                <select name="prize_type" lay-verify="verify_prize_type">
                    <option value="">--</option>
                    <option value="1">特等奖</option>
                    <option value="2">一等奖</option>
                    <option value="3">二等奖</option>
                    <option value="4">三等奖</option>
                    <option value="5">优秀奖</option>
                </select>
            </div>
        </div>

<!--        <div class="layui-form-item" >
            <label class="layui-form-label">申请人<span style="color: red">*</span></label>
            <div class="layui-input-block">
                <input type="text" name="applicantId" id="applicantId" th:value="@{(${session.type}eq '1'?${session.loginUser.sno}:${session.loginUser.tno})}" autocomplete="off" class="layui-input" lay-verify="verify_applicantId" readonly>
            </div>
        </div>-->

        <div class="layui-form-item" >
            <label class="layui-form-label">银行卡号<span style="color: red">*</span></label>
            <div class="layui-input-block">
                <input type="number" name="applicantBankCard" id="applicantBankCard" autocomplete="off" class="layui-input" lay-verify="verify_BankCard">
            </div>
        </div>

        <div class="layui-form-item"  id="teacherArea">
            <button type="button" class="layui-btn" id="addteacher" onclick="chooseTeacherBox()">添加老师</button>
        </div>


        <div class="layui-form-item" style="display: none">
            <div class="layui-inline ">
                <label class="layui-form-label">真实指导老师</label>
                <input type="text" name="ts" id="ts" lay-filter="ts" data-method="offset" value="" data-type="t" autocomplete="off" class="layui-input layui-btn layui-btn-primary">
            </div>
        </div>

        <div class="layui-form-item" id="studentArea">
            <button type="button" class="layui-btn" id="addStudent" onclick="chooseStudentBox(this)">添加成员</button>
            <input type="hidden" name="leader" id="leader" value="">
            <input type="hidden" name="tms" id="tms" value="">
            <div id="studentBoxArea">
            </div>
        </div>

        <div class="layui-form-item layui-form-text" id="div_workBriefIntro">
            <label class="layui-form-label">作品简介<span style="color: red">*</span></label>
            <div class="layui-input-block"  >
                <textarea name="workBriefIntro" placeholder="100字左右即可" class="layui-textarea" lay-verify="verify_workBriefIntro"></textarea>
            </div>
        </div>

        <!-- 上传凭证附件：必填 -->
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 30px;">
            <legend>上传多张凭证图片<span style="color: red">*</span></legend>
        </fieldset>

        <div class="layui-upload">
            <button type="button" class="layui-btn" id="test2" >多图片上传</button>
            <blockquote class="layui-elem-quote layui-quote-nm" style="margin-top: 10px;">
                预览图：
                <div class="layui-upload-list" id="demo2"></div>
            </blockquote>
        </div>

        <div class="layui-form-item">
            <button class="layui-btn" lay-submit="" lay-filter="" id="application_form_btn">提交申请</button>
        </div>
    </div>
    </form>
</div>

<!--<script src="../asserts/js/layui/layui.js" charset="utf-8"></script>-->
<script src="../asserts/js/jquery-1.12.4.js"></script>
<script src="../asserts/js/layui/layui.all.js"></script>

<!--日期与时间选择-->
<!--获得比赛名称-获取选中行数据-->
<script type="text/html" id="toolbar_ctname">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="getCheckData_ctname">获取选中行数据</button>
    </div>
</script>

<!--获得指导老师2-获取选中行数据-->
<script type="text/html" id="toolbar_teacher2Id">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="getCheckData_teacher2Id">获取选中行数据</button>
    </div>
</script>
<!--获得学生-获取选中行数据-->
<script type="text/html" id="toolbar_studentId">
    <div class="layui-btn-container">
        <button class="layui-btn layui-btn-sm" lay-event="getCheckData_studentId">选为项目组长</button>
        <button class="layui-btn layui-btn-sm" lay-event="getCheckData_teamId">选为团队成员</button>
    </div>
</script>
<script>
    layui.define(['table','layer'], function(){
        var table = layui.table;
        var layer = layui.layer; //独立版的layer无需执行这一句
        var $ = layui.jquery;

        var teacherInputCount = 0;  //限制指导老师人数

        var teamCount = 0;  // 限制团队成员人数

        var active = {
            offset: function(othis) {
                var type = othis.data('type')  //给后面弹出层id用的
                layer.open({
                    type: 1  //1为页面层
                    ,title: '匹配比赛名称'  //弹出层标题
                    ,area: '800px'   //设置弹出层大小[宽，高]
                    ,offset: 'auto'   //设置弹出层位置 //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
                    ,id: 'layerDemo_ctname' + type //防止重复弹出，点击这个input只能有一个弹出层
                    ,content:$("#layer_ctname")   //弹出层内容为layer_ctname块，不能直接是表格id
                    , btnAlign: 'c' //按钮居中
                    , shade: 0 //不显示遮罩
                    , yes: function () {  //确定按钮回调方法， 需要手动关闭弹出层
                        layer.closeAll();
                    }
                });
            }
        }

        var active_layer_teacher2Id = {
            offset: function(othis) {
                var type = othis.data('type')  //给后面弹出层id用的

                layer.open({
                    type: 1  //1为页面层
                    ,title: '指导老师2编号'  //弹出层标题
                    ,area: ['800px', '400px']   //设置弹出层大小[宽，高]
                    , offset: 'auto'   //设置弹出层位置 //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
                    , id: 'layerDemo_teacher2Id' + type //防止重复弹出，点击这个input只能有一个弹出层
                    ,content:$("#layer_teacher2Id")   //弹出层内容为layer_ctname块，不能直接是表格id
                    , btnAlign: 'c' //按钮居中
                    , shade: 0 //不显示遮罩
                    , yes: function () {  //确定按钮回调方法， 需要手动关闭弹出层
                        layer.closeAll();
                    }
                });
            }
        };

        //点击input，执行active_layer_ctname（展示比赛名称的弹出层）
        $('#get_tname').on('click', function(){
            var othis = $(this), method = othis.data('method');
            active[method] ? active[method].call(this, othis) : '';
        });

        //点击input，执行active_layer_teacher1Id（展示指导老师的弹出层）
        $('#get_teacher1Id').on('click', function(){
            var othis = $(this), method = othis.data('method');
            active_layer_teacher1Id[method] ? active_layer_teacher1Id[method].call(this, othis) : '';
        });

        //点击input，执行active_layer_teacher1Id（展示指导老师的弹出层）
        $(".teacherInputBox").on('click', function(){
            var othis = $(this), method = othis.data('method');
            active_layer_teacher2Id[method] ? active_layer_teacher2Id[method].call(this, othis) : '';
        });

        // TODO 添加老师按钮
        $('#addteacher').on('click', function(){
            // if (teacherInputCount < 3){     // 限制指导老师框的数量
            //     $("#teacherArea").append("<div class='layui-inline' ><div class='layui-input-inline'>" +
            //         "<input type='text'  data-method=' offset'data-type='t' autocomplete='off' class='layui-input layui-btn layui-btn-primary' onclick='chooseTeacherBox(this)' value='' placeholder=' 选取指导老师'>" +
            //         "<input type='hidden' value='2' class='teacherIDBox'>"+
            //         "</div></div>");
            //     teacherInputCount++;
            // }else{
            //     layer.msg("无法添加更多指导老师");
            // }
        });

        // 比赛名称弹出层>>表格
        table.render({
            elem: '#layer_com_table'
            ,height: 312
            ,url: '/getAllCom' //数据接口
            ,method:"get"
            ,page: true //开启分页
            ,toolbar:'#toolbar_ctname'
            ,cols: [
                [ //表头
                    {type:'radio'}
                    ,{field: 'ctid', title: '竞赛编号', width:103, sort: true}
                    ,{field: 'ctname', title: '学科和科技竞赛名称', width:350}
                    ,{field: 'host_unit', title: '主办单位', width:350}
                ]
            ]
        });

        // 指导老师弹出层>>表格
        table.render({
            elem: '#layer_teacher2Id_table'
            ,height: 312
            ,url: '/getAllTeacher' //数据接口
            ,method:"get"
            ,page: true //开启分页
            ,toolbar:'#toolbar_teacher2Id'
            ,cols: [
                [ //表头
                    {type:'radio'}
                    ,{field: 'tno', title: '教师编号', width:103, sort: true}
                    ,{field: 'tname', title: '教师名称', width:120}
                    ,{field: 'tsex', title: '教师性别', width:120}
                    ,{field: 'dcollege', title: '所属学院', width:120}
                    ,{field: 'dname', title: '所属部门', width:120}
                    ,{field: 'ttitle', title: '教师职称', width:120}
                ]
            ]
        });

        table.render({
            elem: '#layer_studentId_table'
            ,height: 312
            ,method:"get"   // TODO 应该默认就存在表单
            ,page: true //开启分页
            ,toolbar:'#toolbar_studentId'
            ,cols: [
                [ //表头
                    //TODO 也不是所有信息都要显示出来，这里到时候改改
                    {type:'radio'}
                    ,{field: 'sno', title: '学号', sort: true}
                    ,{field: 'sname', title: '姓名'}
                    ,{field: 'ssex', title: '性别'}
                    ,{field: 'sbirthday', title: '出生年月',}  // 待转换数据
                    ,{field: 'sdomitory', title: '寝室'}
                    ,{field: 'cno', title: '班级ID'}
                    ,{field: 'stel', title: '电话'}
                    ,{field: 'state', title: '在校状态'}
                ]
            ]
        });

        // 比赛名称 >> 弹出层 >> 表格实例的单选框的选择的监听工作条（隐藏模块）
        table.on('toolbar(layer_com_table)', function(obj){//注：tool 是工具条事件名，layer_com_table 是 table 原始容器的属性 lay-filter="对应的值"
            var checkStatus = table.checkStatus(obj.config.id); //获取选中行状态
            switch(obj.event){
                case 'getCheckData_ctname':
                    var data = checkStatus.data;  //获取选中行数据
                    document.getElementById("get_tname").value = data[0].ctname;  //将获取的数据中的dno值给input
                    document.getElementById("ctId").value = data[0].ctid;
                    /*'1:考试' '0:作品' */
/*                    如果匹配到的成果类型为考试
                    【参赛作品名称】【项目组长】【作品简介】消失 */
                    if (data[0].result_type==1)
                    {
                        $("#workName").removeAttr("lay-verify");
                        $("#div_workName,#div_textarea,#div_leader,#div_workBriefIntro,#addStudent").addClass("disappear");
                        /*alert($("#div_workName").html());*/
                    }else{
                        $("#div_workName,#div_textarea,#div_leader,#div_workBriefIntro,#addStudent").show();

                    }
                    //TODO else又显示出来
                    layer.closeAll(); //疯狂模式，关闭所有层
                    break;
            };
        });
        // 设置按钮悬停显示tips

        var tip_index = 0;
        $(document).on('mouseenter', '#addteacher', function(){
            tip_index = layer.tips('点击添加教师', '#addteacher', {time: 0});
        }).on('mouseleave', '#addteacher', function(){
            layer.close(tip_index);
        });

        $(document).on('mouseenter', '#addStudent', function(){
            tip_index = layer.tips('点击添加队员', '#addStudent', {time: 0});
        }).on('mouseleave', '#addStudent', function(){
            layer.close(tip_index);
        });

        // 指导老师1 >> 弹出层 >> 表格实例的单选框的选择的监听工作条
        table.on('toolbar(layer_teacher1Id_table)', function(obj){//注：tool 是工具条事件名，layer_com_table 是 table 原始容器的属性 lay-filter="对应的值"
            var checkStatus = table.checkStatus(obj.config.id); //获取选中行状态
            switch(obj.event){
                case 'getCheckData_teacher1Id':
                    var data = checkStatus.data;  //获取选中行数据
                    // document.getElementById("get_teacher1Id").value = data[0].tno;  //将获取的数据中的dno值给input
                    document.getElementById("get_teacher1Id").value = "(工号："+data[0].tno+")" + data[0].tname;
                    //TODO 有关指导老师的修改
                    if (document.getElementById("ts").value != ""){
                        document.getElementById("ts").value = document.getElementById("ts").value+","+ data[0].tno;
                    }else{
                        document.getElementById("ts").value = data[0].tno;
                    }
                    layer.closeAll(); //疯狂模式，关闭所有层
                    break;
            };
        });

        // 指导老师2 >> 弹出层 >> 表格实例的单选框的选择的监听工作条
        table.on('toolbar(layer_teacher2Id_table)', function(obj){//注：tool 是工具条事件名，layer_com_table 是 table 原始容器的属性 lay-filter="对应的值"
            var checkStatus = table.checkStatus(obj.config.id); //获取选中行状态
            switch(obj.event){
                case 'getCheckData_teacher2Id':
                    var data = checkStatus.data;  //获取选中行数据
                    var inpT="<div class='layui-inline' ><div class='layui-input-inline'>" +
                        "<input type='text' class='layui-input layui-btn layui-btn-primary tsBox' value='"+
                        data[0].tno+":"+data[0].tname+
                        "'></div></div>";
                    $("#teacherArea").append(inpT);
                    // if (document.getElementById("ts").value != ""){
                    //     document.getElementById("ts").value = document.getElementById("ts").value+","+ data[0].tno;
                    // }else{
                    //     document.getElementById("ts").value = data[0].tno;
                    // }
                    layer.closeAll(); //疯狂模式，关闭所有层
                    break;
            };
            document.getElementById('ts').value = "";
            $(".tsBox").each(function (index,item) {
                var val1=item.value;
                var aa=val1.split(":")[0];
                document.getElementById('ts').value += ","+aa;
            });
        });
        // 弹出层学生信息的获取
        // TODO 学生获取数据按钮
        table.on('toolbar(layer_studentId_table)', function(obj){//注：tool 是工具条事件名，layer_com_table 是 table 原始容器的属性 lay-filter="对应的值"
            var checkStatus = table.checkStatus(obj.config.id); //获取选中行状态
            // alert("0");
            switch(obj.event){
                case 'getCheckData_studentId':
                    // alert("1");
                    var data = checkStatus.data;  //获取选中行数据
                    var inpS="<div class='layui-inline' ><div class='layui-input-inline'>" +
                        "<input type='text' class='layui-input layui-btn layui-btn-primary layui-bg-cyan comLeaderBox tmsBox' value='"+
                        data[0].sno+":"+data[0].sname+
                        "'></div></div>";
                    //把原来的队长去掉
                    $(".comLeaderBox").removeClass("comLeaderBox");
                    $("#studentBoxArea").prepend(inpS);
                    document.getElementById('leader').value = data[0].sno;
                    layer.closeAll(); //疯狂模式，关闭所有层
                    break;
                case 'getCheckData_teamId':
                    var data = checkStatus.data;  //获取选中行数据
                    var inpS=
                        "<div class='layui-inline' ><div class='layui-input-inline'>" +
                        "<input type='text' class='layui-input layui-btn layui-btn-primary tmsBox' value='"+
                        data[0].sno+":"+data[0].sname+
                        "'></div></div>";
                    if (teamCount < 6){
                        // let teamClass = 'teammate'+teamCount;
                        // $("#tmsArea").append("<input type='text' id=teamClass autocomplete='off' class='layui-input layui-btn layui-btn-primary' onclick='chooseStudentBox(this)'>");
                        // document.getElementById(teamClass).value = data[0].sno+":"+data[0].sname
                        // if (document.getElementById("tms").value != ""){
                        //     document.getElementById("tms").value = document.getElementById("tms").value+","+ data[0].tno;
                        // }else{
                        //     document.getElementById("tms").value = data[0].tno;
                        // }
                        // alert(inpS)
                        $("#studentBoxArea").append(inpS);
                        teamCount++;
                    }else{
                        layer.msg("团队成员不能超过六名");
                    }
                    layer.closeAll(); //疯狂模式，关闭所有层
                    break;
            };
            document.getElementById('tms').value = "";
            // $('#tms').value = "";
            $(".tmsBox").each(function (index,item) {
                // alert(item.value);
                var val1=item.value;
                var aa=val1.split(":")[0];
                // alert(aa)
                document.getElementById('tms').value += ","+aa;
            });
        });


        $('#btn_search_ctname').on('click', function () {      //点击查询调用表格重载，这两行我也没太看懂，就会改个名
            var type = $(this).data('type');      //百度说固定用法，无需深究
            act1[type] ? act1[type].call(this) : '';   //不太懂，反正就开始重载 了
        });


        $('#btn_search_teacher2Id').on('click', function () {
            var type = $(this).data('type');
            act3[type] ? act3[type].call(this) : '';
        });

        $('#btn_search_student').on('click', function () {
            var search_sno = $('#search_sno').val();
            var search_sname = $('#search_sname').val();
            console.log(search_sno);
            console.log(search_sname);
            if (search_sno != ""){  // 如果学号不为空，则按学号搜索
                //执行重载
                table.reload('layer_studentId_table', {
                    method:'POST'
                    ,page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    , where: {
                        sno: search_sno//注意用，隔开
                    }
                    ,url: '/queryBySno'
                }, 'data');
            }
            if (search_sno == "" && search_sname != ""){    // 如果学号为空，名字不为空，则按名字搜索
                //执行重载
                table.reload('layer_studentId_table', {
                    method:'POST'
                    ,page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    , where: {
                        sname: search_sname,//注意用，隔开
                        pageNum : 1,
                        pageSize : 1
                    }
                    ,url: '/queryBySname'    //访问UserController中的方法
                }, 'data');
            }
        });


        //比赛名称条件模糊查询
        var $ = layui.$, act1 = {
            reload: function () {
                var search_ctname = $('#search_ctname').val();
                //执行重载
                console.log(search_ctname);
                table.reload('layer_com_table', {   //layer_com_table为表格的id名
                    method:'POST'
                    ,page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    , where: {
                        ctname: search_ctname
                    }
                    ,url: '/competition/keyword_search_ctname'    //访问controller中的方法
                }, 'data');
            }
        };

        //指导老师条件模糊查询
        var act3 = {
            reload: function () {
                var search_tno = $('#search_tno2').val();
                var search_tname = $('#search_tname2').val();
                var search_dcollege = $('#search_dcollege2').val();
                var search_dname = $('#search_dname2').val();
                var search_ttitle = $('#search_ttitle2').val();
                //执行重载
                table.reload('layer_teacher2Id_table', {   //layer_teacher2Id_table为表格的id名
                    method:'POST'
                    ,page: {
                        curr: 1 //重新从第 1 页开始
                    }
                    , where: {
                        tno: search_tno,//注意用，隔开
                        tname: search_tname,
                        dcollege: search_dcollege,
                        dname:search_dname,
                        ttitle: search_ttitle
                    }
                    ,url: '/teacher1/keyword_search'    //访问UserController中的方法
                }, 'data');
            }
        };

    });
</script>
<script>

    layui.use(['form','laydate','upload'],function(){
        var laydate = layui.laydate;
        var form = layui.form;
        var upload =layui.upload;
        //执行一个laydate实例
        /*日期与时间选择*/
        laydate.render({
            elem: '#awardDate' //指定元素
            ,type: 'date'
            ,trigger: 'click'//呼出事件改成click
        });
        //自定义验证规则
        form.verify({
            verify_ctname: function(value){
                if(value==null|| value == ""){
                    return '比赛名称不能为空';
                }
            }
            ,verify_workName: function(value){
                if(value==null|| value == ""){
                    return '作品名称不能为空';
                }
            }
            ,verify_awardDate: function(value){
                if(value==null|| value == ""){
                    return '获奖时间不能为空';
                }
            }
            ,verify_unit: function(value){
                if(value==null|| value == ""){
                    return '第一单位不能为空！';
                }
                if(value!='南昌大学软件学院'){
                    return '第一单位必须为南昌大学软件学院！';
                }
            }
            ,verify_level_type: function(value){
                if(value==null|| value == ""){
                    return '请选择您的获奖类型(省级/国家级)';
                }
            }
            ,verify_prize_type: function(value){
                if(value==null|| value == ""){
                    return '请选择您的获奖类型(特/一等/二等/三等/优秀)';
                }
            }
            ,verify_applicantId: function(value){
                if(value==null|| value == ""){
                    return '申请人的ID不能为空';
                }
            }
            ,verify_BankCard: function(value){
                if(value==null|| value == ""){
                    return '申请人的银行卡号不能为空';
                }
                if(value.length>20){
                    return '请检查银行卡号是否有误';
                }
            }
            ,verify_workBriefIntro: function(value){
                if(value==null|| value == ""){
                    return '作品简介不能为空';
                }
            }
        });
        upload.render({
            elem: '#test2' //绑定元素
            ,url: '/add/'//上传接口
            ,auto: false
            ,multiple: true
            ,bindAction: '#application_form_btn'
            ,choose:function (obj) {
                //将每次选择的文件追加到文件队列
                files = obj.pushFile();
                //layer.load(); //上传loading
                obj.preview(function (index, file, result) {
                    $(".layui-upload-list").append('<img src="' + result + '" id="remove_' + index + '" title="双击删除该图片" style="width:280px;height:auto;margin-right: 20px;">')
                    $('#remove_' + index).bind('dblclick', function () {//双击删除指定预上传图片
                        delete files[index];//删除指定图片
                        $(this).remove();
                    })
                })

            }
            ,done: function(res){
                //上传完毕回调。
            }
            ,error: function(){
                //请求异常回调
            }
        });
        form.render();//菜单渲染 把内容加载进去
    });
</script>


</body>
</html>

